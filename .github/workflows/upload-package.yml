name: Upload Python Package

on:
    push:
        tags:
            - "v*"

jobs:
    test:
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                python-version: [3.9, 3.10, 3.11, 3.12]
                os: [ubuntu-latest, macOS-latest, windows-latest]

        steps:
            - uses: actions/checkout@v3
            - name: Set up PDM
              uses: pdm-project/setup-pdm@v3
              with:
                  python-version: ${{ matrix.python-version }}

            - name: Install dependencies
              run: |
                  pdm sync -d
            - name: Run Tests
              run: |
                  pdm run -v pytest tests

    pypi-publish:
        name: upload release to PyPI
        runs-on: ubuntu-latest
        permissions:
            # This permission is needed for private repositories.
            contents: read
            # IMPORTANT: this permission is mandatory for trusted publishing
            id-token: write
        steps:
            - uses: actions/checkout@v3

            - uses: pdm-project/setup-pdm@v3

            - name: Publish package distributions to PyPI
              run: pdm publish
